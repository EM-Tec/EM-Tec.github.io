<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hugo on 毛哥EM資訊密技</title><link>https://EM-Tec.github.io/tags/hugo/</link><description>Recent content in Hugo on 毛哥EM資訊密技</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><copyright>2022毛哥EM</copyright><lastBuildDate>Wed, 17 Aug 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://EM-Tec.github.io/tags/hugo/index.xml" rel="self" type="application/rss+xml"/><item><title>【Github Action】自動部署你的Hugo網站</title><link>https://EM-Tec.github.io/post/hugo-githubaction/</link><pubDate>Wed, 17 Aug 2022 00:00:00 +0000</pubDate><guid>https://EM-Tec.github.io/post/hugo-githubaction/</guid><description>
&lt;p>每次寫完文章還要打指令生成網站，麻煩死了！讓Github Action幫你自動部署，寫完文章直角上傳就好了！&lt;/p>
&lt;div class="notices notice">
&lt;div class="label">在開始之前&lt;/div>
&lt;p>請先建立好部落格，並且將整個檔案的資料夾上傳到Github的&lt;code>用戶名/用戶名.github.io&lt;/code>repository
記住不是裡面的&lt;code>public&lt;/code>子資料夾，是整個資料夾喔&lt;/p>
&lt;/div>
&lt;h1 id="要解決的問題">要解決的問題&lt;/h1>
&lt;p>平常我們寫完一篇文章，要先打指令生成靜態網站（生成在&lt;code>public&lt;/code>資料夾裡面），再把它上傳到Github上面。
除了過程十分的麻煩以外，因為網站資料是儲存在你自己的電腦裡面，所以假設你更變工作環境（比如說在手機上）你就沒辦法進行編輯。&lt;/p>
&lt;p>既然每次生成網站的指令都是一樣的，不如我們來建立一個Github Action來讓它自動部署吧&lt;/p>
&lt;h1 id="設定-github">設定 Github&lt;/h1>
&lt;h2 id="設定-access-token">設定 Access Token&lt;/h2>
&lt;p>首先我們要先建立一個Repository 的 Access Token。這是一把鑰匙，我們要把鑰匙給Github Action的程式它才可以部署我們的網站&lt;/p>
&lt;p>請先到&lt;code>Settings/Developer Settings&lt;/code>下的&lt;code>Personal access tokens&lt;/code>生成一組&lt;code>Access Token&lt;/code>。建議scope直接選repo的所有權限。&lt;/p>
&lt;p>&lt;img src="https://EM-Tec.github.io/images/hugo-githubAction-access-token.png" alt="生成Access Token">&lt;/p>
&lt;h2 id="添加-secrets">添加 Secrets&lt;/h2>
&lt;p>因為我們的Github Action程式碼是公開的，但是我們不想要讓其他人看到剛才的那組Access Token，所以我們要建立一組Secret。當我們在程式說要「那個東西」的時候，他就會知道要來這裡找這組密碼。&lt;/p>
&lt;p>請到&lt;code>Settings/Secrets&lt;/code>新增一組 Secrets，我這邊叫做 ACCESS_TOKEN，之後在腳本上會用到。&lt;/p>
&lt;p>&lt;img src="https://EM-Tec.github.io/images/hugo-githubAction-sectets.png" alt="添加Secrets">&lt;/p>
&lt;h2 id="新增workflow">新增Workflow&lt;/h2>
&lt;p>依序點擊Action，New，set up a workflow yourself，並貼上以下程式。名稱可以自己取，貼上完之後點擊Start Commit。&lt;/p>
&lt;p>&lt;img src="https://EM-Tec.github.io/images/hugo-githubAction-access-workflow.jpg" alt="設定Workflow">&lt;/p>
&lt;p>程式意思是當main分支有push操作時（就是你上傳或更變檔案），會生成靜態網頁。剛才不是說會生成在&lt;code>public&lt;/code>這個資料夾，我們把它推送到 gh-pages 這個分支（當然你也可以自己取名）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="ln"> 1&lt;/span>name: create
&lt;span class="ln"> 2&lt;/span>
&lt;span class="ln"> 3&lt;/span>on:
&lt;span class="ln"> 4&lt;/span> push:
&lt;span class="ln"> 5&lt;/span> branches:
&lt;span class="ln"> 6&lt;/span> - main # 當main分支有push操作時
&lt;span class="ln"> 7&lt;/span>
&lt;span class="ln"> 8&lt;/span>jobs:
&lt;span class="ln"> 9&lt;/span> deploy:
&lt;span class="ln">10&lt;/span> runs-on: ubuntu-18.04
&lt;span class="ln">11&lt;/span> steps:
&lt;span class="ln">12&lt;/span> - uses: actions/checkout@v2
&lt;span class="ln">13&lt;/span> with:
&lt;span class="ln">14&lt;/span> submodules: true # 找尋Hugo主題(true OR recursive)
&lt;span class="ln">15&lt;/span> fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod
&lt;span class="ln">16&lt;/span>
&lt;span class="ln">17&lt;/span> - name: Setup Hugo
&lt;span class="ln">18&lt;/span> uses: peaceiris/actions-hugo@v2
&lt;span class="ln">19&lt;/span> with:
&lt;span class="ln">20&lt;/span> hugo-version: &amp;#39;0.89.4&amp;#39; # hugo 版本
&lt;span class="ln">21&lt;/span> extended: true
&lt;span class="ln">22&lt;/span>
&lt;span class="ln">23&lt;/span> - name: Build
&lt;span class="ln">24&lt;/span> run: hugo --minify
&lt;span class="ln">25&lt;/span>
&lt;span class="ln">26&lt;/span> - name: Deploy
&lt;span class="ln">27&lt;/span> uses: peaceiris/actions-gh-pages@v3
&lt;span class="ln">28&lt;/span> with:
&lt;span class="ln">29&lt;/span> github_token: ${{ secrets.HUGO_DEPLOY_TOKEN }}
&lt;span class="ln">30&lt;/span> PUBLISH_BRANCH: gh-pages # 推送到 gh-pages 分支
&lt;span class="ln">31&lt;/span> PUBLISH_DIR: ./public # hugo 生成的目錄
&lt;span class="ln">32&lt;/span> commit_message: ${{github.event.head_commit.message }}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>新增完成後它會自己跑一次。不過我們還需要做一個設定。生成的網站是放在&lt;code>gh-pages&lt;/code>這個分支，我們要輸入網址時，去讀取這個分支而不是main。所以請到&lt;code>Settings/Pages/Branch&lt;/code>更改&lt;/p>
&lt;p>&lt;img src="https://EM-Tec.github.io/images/hugo-githubAction-branch.jpg" alt="更改Branch">&lt;/p>
&lt;p>這樣就大公告成囉！記得每次更新完部落格Github Action都需要大約30秒的執行時間才會完成部署。如果你想要查看它的進度狀態可以點擊最新紀錄的橘點看目前的即時狀態。如果變成綠色就是部署成功，如果是鴻森代表有問題（通常是文章中的語法有語法錯誤）。&lt;/p></description></item></channel></rss>